# Copyright ZenTao, Inc.
# SPDX-License-Identifier: APACHE-2.0

command:
  # Check explicitly enabled and disabled modules
  check-apache-loaded-modules:
    exec: apachectl -M
    exit-status: 0
    stdout:
      - "php7_module"
      - "mpm_prefork_module"
      - "!mpm_event_module"

  check-used-config:
    exec: php --ini
    exit-status: 0
    stdout:
      - "/opt/zbox/etc/php/php.ini"
      - "/opt/zbox/etc/php/conf.d"
  check-config-syntax:
    exec: php -l /opt/zbox/etc/php/php.ini
    exit-status: 0
  check-enabled-modules:
    exec: php -i
    exit-status: 0
    stdout:
    {{ range $module := .Vars.modules.enabled }}
      - /{{ $module }}.*enabled/
    {{ end }}